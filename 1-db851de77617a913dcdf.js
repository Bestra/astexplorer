webpackJsonp([1],{"./node_modules/codemirror/addon/hint/show-hint.js":function(module,exports,__webpack_require__){!function(mod){mod(__webpack_require__("./node_modules/codemirror/lib/codemirror.js"))}(function(CodeMirror){"use strict";function Completion(cm,options){this.cm=cm,this.options=options,this.widget=null,this.debounce=0,this.tick=0,this.startPos=this.cm.getCursor("start"),this.startLen=this.cm.getLine(this.startPos.line).length-this.cm.getSelection().length;var self=this;cm.on("cursorActivity",this.activityFunc=function(){self.cursorActivity()})}function isNewCompletion(old,nw){var moved=CodeMirror.cmpPos(nw.from,old.from);return moved>0&&old.to.ch-old.from.ch!=nw.to.ch-nw.from.ch}function parseOptions(cm,pos,options){var editor=cm.options.hintOptions,out={};for(var prop in defaultOptions)out[prop]=defaultOptions[prop];if(editor)for(var prop in editor)void 0!==editor[prop]&&(out[prop]=editor[prop]);if(options)for(var prop in options)void 0!==options[prop]&&(out[prop]=options[prop]);return out.hint.resolve&&(out.hint=out.hint.resolve(cm,pos)),out}function getText(completion){return"string"==typeof completion?completion:completion.text}function buildKeyMap(completion,handle){function addBinding(key,val){var bound;bound="string"!=typeof val?function(cm){return val(cm,handle)}:baseMap.hasOwnProperty(val)?baseMap[val]:val,ourMap[key]=bound}var baseMap={Up:function(){handle.moveFocus(-1)},Down:function(){handle.moveFocus(1)},PageUp:function(){handle.moveFocus(-handle.menuSize()+1,!0)},PageDown:function(){handle.moveFocus(handle.menuSize()-1,!0)},Home:function(){handle.setFocus(0)},End:function(){handle.setFocus(handle.length-1)},Enter:handle.pick,Tab:handle.pick,Esc:handle.close},custom=completion.options.customKeys,ourMap=custom?{}:baseMap;if(custom)for(var key in custom)custom.hasOwnProperty(key)&&addBinding(key,custom[key]);var extra=completion.options.extraKeys;if(extra)for(var key in extra)extra.hasOwnProperty(key)&&addBinding(key,extra[key]);return ourMap}function getHintElement(hintsElement,el){for(;el&&el!=hintsElement;){if("LI"===el.nodeName.toUpperCase()&&el.parentNode==hintsElement)return el;el=el.parentNode}}function Widget(completion,data){this.completion=completion,this.data=data,this.picked=!1;var widget=this,cm=completion.cm,hints=this.hints=document.createElement("ul");hints.className="CodeMirror-hints",this.selectedHint=data.selectedHint||0;for(var completions=data.list,i=0;i<completions.length;++i){var elt=hints.appendChild(document.createElement("li")),cur=completions[i],className=HINT_ELEMENT_CLASS+(i!=this.selectedHint?"":" "+ACTIVE_HINT_ELEMENT_CLASS);null!=cur.className&&(className=cur.className+" "+className),elt.className=className,cur.render?cur.render(elt,data,cur):elt.appendChild(document.createTextNode(cur.displayText||getText(cur))),elt.hintId=i}var pos=cm.cursorCoords(completion.options.alignWithWord?data.from:null),left=pos.left,top=pos.bottom,below=!0;hints.style.left=left+"px",hints.style.top=top+"px";var winW=window.innerWidth||Math.max(document.body.offsetWidth,document.documentElement.offsetWidth),winH=window.innerHeight||Math.max(document.body.offsetHeight,document.documentElement.offsetHeight);(completion.options.container||document.body).appendChild(hints);var box=hints.getBoundingClientRect(),overlapY=box.bottom-winH;if(overlapY>0){var height=box.bottom-box.top,curTop=pos.top-(pos.bottom-box.top);if(curTop-height>0)hints.style.top=(top=pos.top-height)+"px",below=!1;else if(height>winH){hints.style.height=winH-5+"px",hints.style.top=(top=pos.bottom-box.top)+"px";var cursor=cm.getCursor();data.from.ch!=cursor.ch&&(pos=cm.cursorCoords(cursor),hints.style.left=(left=pos.left)+"px",box=hints.getBoundingClientRect())}}var overlapX=box.right-winW;if(overlapX>0&&(box.right-box.left>winW&&(hints.style.width=winW-5+"px",overlapX-=box.right-box.left-winW),hints.style.left=(left=pos.left-overlapX)+"px"),cm.addKeyMap(this.keyMap=buildKeyMap(completion,{moveFocus:function(n,avoidWrap){widget.changeActive(widget.selectedHint+n,avoidWrap)},setFocus:function(n){widget.changeActive(n)},menuSize:function(){return widget.screenAmount()},length:completions.length,close:function(){completion.close()},pick:function(){widget.pick()},data:data})),completion.options.closeOnUnfocus){var closingOnBlur;cm.on("blur",this.onBlur=function(){closingOnBlur=setTimeout(function(){completion.close()},100)}),cm.on("focus",this.onFocus=function(){clearTimeout(closingOnBlur)})}var startScroll=cm.getScrollInfo();return cm.on("scroll",this.onScroll=function(){var curScroll=cm.getScrollInfo(),editor=cm.getWrapperElement().getBoundingClientRect(),newTop=top+startScroll.top-curScroll.top,point=newTop-(window.pageYOffset||(document.documentElement||document.body).scrollTop);return below||(point+=hints.offsetHeight),point<=editor.top||point>=editor.bottom?completion.close():(hints.style.top=newTop+"px",void(hints.style.left=left+startScroll.left-curScroll.left+"px"))}),CodeMirror.on(hints,"dblclick",function(e){var t=getHintElement(hints,e.target||e.srcElement);t&&null!=t.hintId&&(widget.changeActive(t.hintId),widget.pick())}),CodeMirror.on(hints,"click",function(e){var t=getHintElement(hints,e.target||e.srcElement);t&&null!=t.hintId&&(widget.changeActive(t.hintId),completion.options.completeOnSingleClick&&widget.pick())}),CodeMirror.on(hints,"mousedown",function(){setTimeout(function(){cm.focus()},20)}),CodeMirror.signal(data,"select",completions[0],hints.firstChild),!0}function applicableHelpers(cm,helpers){if(!cm.somethingSelected())return helpers;for(var result=[],i=0;i<helpers.length;i++)helpers[i].supportsSelection&&result.push(helpers[i]);return result}function resolveAutoHints(cm,pos){var words,helpers=cm.getHelpers(pos,"hint");if(helpers.length){for(var resolved,async=!1,i=0;i<helpers.length;i++)helpers[i].async&&(async=!0);return async?(resolved=function(cm,callback,options){function run(i,result){if(i==app.length)return callback(null);var helper=app[i];if(helper.async)helper(cm,function(result){result?callback(result):run(i+1)},options);else{var result=helper(cm,options);result?callback(result):run(i+1)}}var app=applicableHelpers(cm,helpers);run(0)},resolved.async=!0):resolved=function(cm,options){for(var app=applicableHelpers(cm,helpers),i=0;i<app.length;i++){var cur=app[i](cm,options);if(cur&&cur.list.length)return cur}},resolved.supportsSelection=!0,resolved}return(words=cm.getHelper(cm.getCursor(),"hintWords"))?function(cm){return CodeMirror.hint.fromList(cm,{words:words})}:CodeMirror.hint.anyword?function(cm,options){return CodeMirror.hint.anyword(cm,options)}:function(){}}var HINT_ELEMENT_CLASS="CodeMirror-hint",ACTIVE_HINT_ELEMENT_CLASS="CodeMirror-hint-active";CodeMirror.showHint=function(cm,getHints,options){if(!getHints)return cm.showHint(options);options&&options.async&&(getHints.async=!0);var newOpts={hint:getHints};if(options)for(var prop in options)newOpts[prop]=options[prop];return cm.showHint(newOpts)},CodeMirror.defineExtension("showHint",function(options){options=parseOptions(this,this.getCursor("start"),options);var selections=this.listSelections();if(!(selections.length>1)){if(this.somethingSelected()){if(!options.hint.supportsSelection)return;for(var i=0;i<selections.length;i++)if(selections[i].head.line!=selections[i].anchor.line)return}this.state.completionActive&&this.state.completionActive.close();var completion=this.state.completionActive=new Completion(this,options);completion.options.hint&&(CodeMirror.signal(this,"startCompletion",this),completion.update(!0))}});var requestAnimationFrame=window.requestAnimationFrame||function(fn){return setTimeout(fn,1e3/60)},cancelAnimationFrame=window.cancelAnimationFrame||clearTimeout;Completion.prototype={close:function(){this.active()&&(this.cm.state.completionActive=null,this.tick=null,this.cm.off("cursorActivity",this.activityFunc),this.widget&&this.data&&CodeMirror.signal(this.data,"close"),this.widget&&this.widget.close(),CodeMirror.signal(this.cm,"endCompletion",this.cm))},active:function(){return this.cm.state.completionActive==this},pick:function(data,i){var completion=data.list[i];completion.hint?completion.hint(this.cm,data,completion):this.cm.replaceRange(getText(completion),completion.from||data.from,completion.to||data.to,"complete"),CodeMirror.signal(data,"pick",completion),this.close()},cursorActivity:function(){this.debounce&&(cancelAnimationFrame(this.debounce),this.debounce=0);var pos=this.cm.getCursor(),line=this.cm.getLine(pos.line);if(pos.line!=this.startPos.line||line.length-pos.ch!=this.startLen-this.startPos.ch||pos.ch<this.startPos.ch||this.cm.somethingSelected()||pos.ch&&this.options.closeCharacters.test(line.charAt(pos.ch-1)))this.close();else{var self=this;this.debounce=requestAnimationFrame(function(){self.update()}),this.widget&&this.widget.disable()}},update:function(first){if(null!=this.tick)if(this.options.hint.async){var myTick=++this.tick,self=this;this.options.hint(this.cm,function(data){self.tick==myTick&&self.finishUpdate(data,first)},this.options)}else this.finishUpdate(this.options.hint(this.cm,this.options),first)},finishUpdate:function(data,first){this.data&&CodeMirror.signal(this.data,"update");var picked=this.widget&&this.widget.picked||first&&this.options.completeSingle;this.widget&&this.widget.close(),data&&this.data&&isNewCompletion(this.data,data)||(this.data=data,data&&data.list.length&&(picked&&1==data.list.length?this.pick(data,0):(this.widget=new Widget(this,data),CodeMirror.signal(data,"shown"))))}},Widget.prototype={close:function(){if(this.completion.widget==this){this.completion.widget=null,this.hints.parentNode.removeChild(this.hints),this.completion.cm.removeKeyMap(this.keyMap);var cm=this.completion.cm;this.completion.options.closeOnUnfocus&&(cm.off("blur",this.onBlur),cm.off("focus",this.onFocus)),cm.off("scroll",this.onScroll)}},disable:function(){this.completion.cm.removeKeyMap(this.keyMap);var widget=this;this.keyMap={Enter:function(){widget.picked=!0}},this.completion.cm.addKeyMap(this.keyMap)},pick:function(){this.completion.pick(this.data,this.selectedHint)},changeActive:function(i,avoidWrap){if(i>=this.data.list.length?i=avoidWrap?this.data.list.length-1:0:0>i&&(i=avoidWrap?0:this.data.list.length-1),this.selectedHint!=i){var node=this.hints.childNodes[this.selectedHint];node.className=node.className.replace(" "+ACTIVE_HINT_ELEMENT_CLASS,""),node=this.hints.childNodes[this.selectedHint=i],node.className+=" "+ACTIVE_HINT_ELEMENT_CLASS,node.offsetTop<this.hints.scrollTop?this.hints.scrollTop=node.offsetTop-3:node.offsetTop+node.offsetHeight>this.hints.scrollTop+this.hints.clientHeight&&(this.hints.scrollTop=node.offsetTop+node.offsetHeight-this.hints.clientHeight+3),CodeMirror.signal(this.data,"select",this.data.list[this.selectedHint],node)}},screenAmount:function(){return Math.floor(this.hints.clientHeight/this.hints.firstChild.offsetHeight)||1}},CodeMirror.registerHelper("hint","auto",{resolve:resolveAutoHints}),CodeMirror.registerHelper("hint","fromList",function(cm,options){var cur=cm.getCursor(),token=cm.getTokenAt(cur),to=CodeMirror.Pos(cur.line,token.end);if(token.string&&/\w/.test(token.string[token.string.length-1]))var term=token.string,from=CodeMirror.Pos(cur.line,token.start);else var term="",from=to;for(var found=[],i=0;i<options.words.length;i++){var word=options.words[i];word.slice(0,term.length)==term&&found.push(word)}return found.length?{list:found,from:from,to:to}:void 0}),CodeMirror.commands.autocomplete=CodeMirror.showHint;var defaultOptions={hint:CodeMirror.hint.auto,completeSingle:!0,alignWithWord:!0,closeCharacters:/[\s()\[\]{};:>,]/,closeOnUnfocus:!0,completeOnSingleClick:!0,container:null,customKeys:null,extraKeys:null};CodeMirror.defineOption("hintOptions",null)})},"./node_modules/codemirror/addon/tern/tern.js":function(module,exports,__webpack_require__){!function(mod){mod(__webpack_require__("./node_modules/codemirror/lib/codemirror.js"))}(function(CodeMirror){"use strict";function getFile(ts,name,c){var buf=ts.docs[name];buf?c(docValue(ts,buf)):ts.options.getFile?ts.options.getFile(name,c):c(null)}function findDoc(ts,doc,name){for(var n in ts.docs){var cur=ts.docs[n];if(cur.doc==doc)return cur}if(!name)for(var i=0;;++i)if(n="[doc"+(i||"")+"]",!ts.docs[n]){name=n;break}return ts.addDoc(name,doc)}function resolveDoc(ts,id){return"string"==typeof id?ts.docs[id]:(id instanceof CodeMirror&&(id=id.getDoc()),id instanceof CodeMirror.Doc?findDoc(ts,id):void 0)}function trackChange(ts,doc,change){var data=findDoc(ts,doc),argHints=ts.cachedArgHints;argHints&&argHints.doc==doc&&cmpPos(argHints.start,change.to)<=0&&(ts.cachedArgHints=null);var changed=data.changed;null==changed&&(data.changed=changed={from:change.from.line,to:change.from.line});var end=change.from.line+(change.text.length-1);change.from.line<changed.to&&(changed.to=changed.to-(change.to.line-end)),end>=changed.to&&(changed.to=end+1),changed.from>change.from.line&&(changed.from=change.from.line),doc.lineCount()>bigDoc&&change.to-changed.from>100&&setTimeout(function(){data.changed&&data.changed.to-data.changed.from>100&&sendDoc(ts,data)},200)}function sendDoc(ts,doc){ts.server.request({files:[{type:"full",name:doc.name,text:docValue(ts,doc)}]},function(error){error?window.console.error(error):doc.changed=null})}function hint(ts,cm,c){ts.request(cm,{type:"completions",types:!0,docs:!0,urls:!0},function(error,data){if(error)return showError(ts,cm,error);var completions=[],after="",from=data.start,to=data.end;'["'==cm.getRange(Pos(from.line,from.ch-2),from)&&'"]'!=cm.getRange(to,Pos(to.line,to.ch+2))&&(after='"]');for(var i=0;i<data.completions.length;++i){var completion=data.completions[i],className=typeToIcon(completion.type);data.guess&&(className+=" "+cls+"guess"),completions.push({text:completion.name+after,displayText:completion.displayName||completion.name,className:className,data:completion})}var obj={from:from,to:to,list:completions},tooltip=null;CodeMirror.on(obj,"close",function(){remove(tooltip)}),CodeMirror.on(obj,"update",function(){remove(tooltip)}),CodeMirror.on(obj,"select",function(cur,node){remove(tooltip);var content=ts.options.completionTip?ts.options.completionTip(cur.data):cur.data.doc;content&&(tooltip=makeTooltip(node.parentNode.getBoundingClientRect().right+window.pageXOffset,node.getBoundingClientRect().top+window.pageYOffset,content),tooltip.className+=" "+cls+"hint-doc")}),c(obj)})}function typeToIcon(type){var suffix;return suffix="?"==type?"unknown":"number"==type||"string"==type||"bool"==type?type:/^fn\(/.test(type)?"fn":/^\[/.test(type)?"array":"object",cls+"completion "+cls+"completion-"+suffix}function showContextInfo(ts,cm,pos,queryName,c){ts.request(cm,queryName,function(error,data){if(error)return showError(ts,cm,error);if(ts.options.typeTip)var tip=ts.options.typeTip(data);else{var tip=elt("span",null,elt("strong",null,data.type||"not found"));if(data.doc&&tip.appendChild(document.createTextNode(" — "+data.doc)),data.url){tip.appendChild(document.createTextNode(" "));var child=tip.appendChild(elt("a",null,"[docs]"));child.href=data.url,child.target="_blank"}}tempTooltip(cm,tip,ts),c&&c()},pos)}function updateArgHints(ts,cm){if(closeArgHints(ts),!cm.somethingSelected()){var state=cm.getTokenAt(cm.getCursor()).state,inner=CodeMirror.innerMode(cm.getMode(),state);if("javascript"==inner.mode.name){var lex=inner.state.lexical;if("call"==lex.info){for(var ch,argPos=lex.pos||0,tabSize=cm.getOption("tabSize"),line=cm.getCursor().line,e=Math.max(0,line-9),found=!1;line>=e;--line){for(var str=cm.getLine(line),extra=0,pos=0;;){var tab=str.indexOf("	",pos);if(-1==tab)break;extra+=tabSize-(tab+extra)%tabSize-1,pos=tab+1}if(ch=lex.column-extra,"("==str.charAt(ch)){found=!0;break}}if(found){var start=Pos(line,ch),cache=ts.cachedArgHints;return cache&&cache.doc==cm.getDoc()&&0==cmpPos(start,cache.start)?showArgHints(ts,cm,argPos):void ts.request(cm,{type:"type",preferFunction:!0,end:start},function(error,data){!error&&data.type&&/^fn\(/.test(data.type)&&(ts.cachedArgHints={start:pos,type:parseFnType(data.type),name:data.exprName||data.name||"fn",guess:data.guess,doc:cm.getDoc()},showArgHints(ts,cm,argPos))})}}}}}function showArgHints(ts,cm,pos){closeArgHints(ts);for(var cache=ts.cachedArgHints,tp=cache.type,tip=elt("span",cache.guess?cls+"fhint-guess":null,elt("span",cls+"fname",cache.name),"("),i=0;i<tp.args.length;++i){i&&tip.appendChild(document.createTextNode(", "));var arg=tp.args[i];tip.appendChild(elt("span",cls+"farg"+(i==pos?" "+cls+"farg-current":""),arg.name||"?")),"?"!=arg.type&&(tip.appendChild(document.createTextNode(": ")),tip.appendChild(elt("span",cls+"type",arg.type)))}tip.appendChild(document.createTextNode(tp.rettype?") -> ":")")),tp.rettype&&tip.appendChild(elt("span",cls+"type",tp.rettype));var place=cm.cursorCoords(null,"page");ts.activeArgHints=makeTooltip(place.right+1,place.bottom,tip)}function parseFnType(text){function skipMatching(upto){for(var depth=0,start=pos;;){var next=text.charAt(pos);if(upto.test(next)&&!depth)return text.slice(start,pos);/[{\[\(]/.test(next)?++depth:/[}\]\)]/.test(next)&&--depth,++pos}}var args=[],pos=3;if(")"!=text.charAt(pos))for(;;){var name=text.slice(pos).match(/^([^, \(\[\{]+): /);if(name&&(pos+=name[0].length,name=name[1]),args.push({name:name,type:skipMatching(/[\),]/)}),")"==text.charAt(pos))break;pos+=2}var rettype=text.slice(pos).match(/^\) -> (.*)$/);return{args:args,rettype:rettype&&rettype[1]}}function jumpToDef(ts,cm){function inner(varName){var req={type:"definition",variable:varName||null},doc=findDoc(ts,cm.getDoc());ts.server.request(buildRequest(ts,doc,req),function(error,data){if(error)return showError(ts,cm,error);if(!data.file&&data.url)return void window.open(data.url);if(data.file){var found,localDoc=ts.docs[data.file];if(localDoc&&(found=findContext(localDoc.doc,data)))return ts.jumpStack.push({file:doc.name,start:cm.getCursor("from"),end:cm.getCursor("to")}),void moveTo(ts,doc,localDoc,found.start,found.end)}showError(ts,cm,"Could not find a definition.")})}atInterestingExpression(cm)?inner():dialog(cm,"Jump to variable",function(name){name&&inner(name)})}function jumpBack(ts,cm){var pos=ts.jumpStack.pop(),doc=pos&&ts.docs[pos.file];doc&&moveTo(ts,findDoc(ts,cm.getDoc()),doc,pos.start,pos.end)}function moveTo(ts,curDoc,doc,start,end){doc.doc.setSelection(start,end),curDoc!=doc&&ts.options.switchToDoc&&(closeArgHints(ts),ts.options.switchToDoc(doc.name,doc.doc))}function findContext(doc,data){for(var before=data.context.slice(0,data.contextOffset).split("\n"),startLine=data.start.line-(before.length-1),start=Pos(startLine,(1==before.length?data.start.ch:doc.getLine(startLine).length)-before[0].length),text=doc.getLine(startLine).slice(start.ch),cur=startLine+1;cur<doc.lineCount()&&text.length<data.context.length;++cur)text+="\n"+doc.getLine(cur);if(text.slice(0,data.context.length)==data.context)return data;for(var nearest,cursor=doc.getSearchCursor(data.context,0,!1),nearestDist=1/0;cursor.findNext();){var from=cursor.from(),dist=1e4*Math.abs(from.line-start.line);dist||(dist=Math.abs(from.ch-start.ch)),nearestDist>dist&&(nearest=from,nearestDist=dist)}if(!nearest)return null;if(1==before.length?nearest.ch+=before[0].length:nearest=Pos(nearest.line+(before.length-1),before[before.length-1].length),data.start.line==data.end.line)var end=Pos(nearest.line,nearest.ch+(data.end.ch-data.start.ch));else var end=Pos(nearest.line+(data.end.line-data.start.line),data.end.ch);return{start:nearest,end:end}}function atInterestingExpression(cm){var pos=cm.getCursor("end"),tok=cm.getTokenAt(pos);return tok.start<pos.ch&&"comment"==tok.type?!1:/[\w)\]]/.test(cm.getLine(pos.line).slice(Math.max(pos.ch-1,0),pos.ch+1))}function rename(ts,cm){var token=cm.getTokenAt(cm.getCursor());return/\w/.test(token.string)?void dialog(cm,"New name for "+token.string,function(newName){ts.request(cm,{type:"rename",newName:newName,fullDocs:!0},function(error,data){return error?showError(ts,cm,error):void applyChanges(ts,data.changes)})}):showError(ts,cm,"Not at a variable")}function selectName(ts,cm){var name=findDoc(ts,cm.doc).name;ts.request(cm,{type:"refs"},function(error,data){if(error)return showError(ts,cm,error);for(var ranges=[],cur=0,curPos=cm.getCursor(),i=0;i<data.refs.length;i++){var ref=data.refs[i];ref.file==name&&(ranges.push({anchor:ref.start,head:ref.end}),cmpPos(curPos,ref.start)>=0&&cmpPos(curPos,ref.end)<=0&&(cur=ranges.length-1))}cm.setSelections(ranges,cur)})}function applyChanges(ts,changes){for(var perFile=Object.create(null),i=0;i<changes.length;++i){var ch=changes[i];(perFile[ch.file]||(perFile[ch.file]=[])).push(ch)}for(var file in perFile){var known=ts.docs[file],chs=perFile[file];if(known){chs.sort(function(a,b){return cmpPos(b.start,a.start)});for(var origin="*rename"+ ++nextChangeOrig,i=0;i<chs.length;++i){var ch=chs[i];known.doc.replaceRange(ch.text,ch.start,ch.end,origin)}}}}function buildRequest(ts,doc,query,pos){var files=[],offsetLines=0,allowFragments=!query.fullDocs;allowFragments||delete query.fullDocs,"string"==typeof query&&(query={type:query}),query.lineCharPositions=!0,null==query.end&&(query.end=pos||doc.doc.getCursor("end"),doc.doc.somethingSelected()&&(query.start=doc.doc.getCursor("start")));var startPos=query.start||query.end;if(doc.changed)if(doc.doc.lineCount()>bigDoc&&allowFragments!==!1&&doc.changed.to-doc.changed.from<100&&doc.changed.from<=startPos.line&&doc.changed.to>query.end.line){files.push(getFragmentAround(doc,startPos,query.end)),query.file="#0";var offsetLines=files[0].offsetLines;null!=query.start&&(query.start=Pos(query.start.line- -offsetLines,query.start.ch)),query.end=Pos(query.end.line-offsetLines,query.end.ch)}else files.push({type:"full",name:doc.name,text:docValue(ts,doc)}),query.file=doc.name,doc.changed=null;else query.file=doc.name;for(var name in ts.docs){var cur=ts.docs[name];cur.changed&&cur!=doc&&(files.push({type:"full",name:cur.name,text:docValue(ts,cur)}),cur.changed=null)}return{query:query,files:files}}function getFragmentAround(data,start,end){for(var endLine,doc=data.doc,minIndent=null,minLine=null,tabSize=4,p=start.line-1,min=Math.max(0,p-50);p>=min;--p){var line=doc.getLine(p),fn=line.search(/\bfunction\b/);if(!(0>fn)){var indent=CodeMirror.countColumn(line,null,tabSize);null!=minIndent&&indent>=minIndent||(minIndent=indent,minLine=p)}}null==minLine&&(minLine=min);var max=Math.min(doc.lastLine(),end.line+20);if(null==minIndent||minIndent==CodeMirror.countColumn(doc.getLine(start.line),null,tabSize))endLine=max;else for(endLine=end.line+1;max>endLine;++endLine){var indent=CodeMirror.countColumn(doc.getLine(endLine),null,tabSize);if(minIndent>=indent)break}var from=Pos(minLine,0);return{type:"part",name:data.name,offsetLines:from.line,text:doc.getRange(from,Pos(endLine,0))}}function elt(tagname,cls){var e=document.createElement(tagname);cls&&(e.className=cls);for(var i=2;i<arguments.length;++i){var elt=arguments[i];"string"==typeof elt&&(elt=document.createTextNode(elt)),e.appendChild(elt)}return e}function dialog(cm,text,f){cm.openDialog?cm.openDialog(text+": <input type=text>",f):f(prompt(text,""))}function tempTooltip(cm,content,ts){function maybeClear(){old=!0,mouseOnTip||clear()}function clear(){cm.state.ternTooltip=null,tip.parentNode&&(cm.off("cursorActivity",clear),cm.off("blur",clear),cm.off("scroll",clear),fadeOut(tip))}cm.state.ternTooltip&&remove(cm.state.ternTooltip);var where=cm.cursorCoords(),tip=cm.state.ternTooltip=makeTooltip(where.right+1,where.bottom,content),mouseOnTip=!1,old=!1;CodeMirror.on(tip,"mousemove",function(){mouseOnTip=!0}),CodeMirror.on(tip,"mouseout",function(e){CodeMirror.contains(tip,e.relatedTarget||e.toElement)||(old?clear():mouseOnTip=!1)}),setTimeout(maybeClear,ts.options.hintDelay?ts.options.hintDelay:1700),cm.on("cursorActivity",clear),cm.on("blur",clear),cm.on("scroll",clear)}function makeTooltip(x,y,content){var node=elt("div",cls+"tooltip",content);return node.style.left=x+"px",node.style.top=y+"px",document.body.appendChild(node),node}function remove(node){var p=node&&node.parentNode;p&&p.removeChild(node)}function fadeOut(tooltip){tooltip.style.opacity="0",setTimeout(function(){remove(tooltip)},1100)}function showError(ts,cm,msg){ts.options.showError?ts.options.showError(cm,msg):tempTooltip(cm,String(msg),ts)}function closeArgHints(ts){ts.activeArgHints&&(remove(ts.activeArgHints),ts.activeArgHints=null)}function docValue(ts,doc){var val=doc.doc.getValue();return ts.options.fileFilter&&(val=ts.options.fileFilter(val,doc.name,doc.doc)),val}function WorkerServer(ts){function send(data,c){c&&(data.id=++msgId,pending[msgId]=c),worker.postMessage(data)}var worker=ts.worker=new Worker(ts.options.workerScript);worker.postMessage({type:"init",defs:ts.options.defs,plugins:ts.options.plugins,scripts:ts.options.workerDeps});var msgId=0,pending={};worker.onmessage=function(e){var data=e.data;"getFile"==data.type?getFile(ts,data.name,function(err,text){send({type:"getFile",err:String(err),text:text,id:data.id})}):"debug"==data.type?window.console.log(data.message):data.id&&pending[data.id]&&(pending[data.id](data.err,data.body),delete pending[data.id])},worker.onerror=function(e){for(var id in pending)pending[id](e);pending={}},this.addFile=function(name,text){send({type:"add",name:name,text:text})},this.delFile=function(name){send({type:"del",name:name})},this.request=function(body,c){send({type:"req",body:body},c)}}CodeMirror.TernServer=function(options){var self=this;this.options=options||{};var plugins=this.options.plugins||(this.options.plugins={});plugins.doc_comment||(plugins.doc_comment=!0),this.docs=Object.create(null),this.options.useWorker?this.server=new WorkerServer(this):this.server=new tern.Server({getFile:function(name,c){return getFile(self,name,c)},async:!0,defs:this.options.defs||[],plugins:plugins}),this.trackChange=function(doc,change){trackChange(self,doc,change)},this.cachedArgHints=null,this.activeArgHints=null,this.jumpStack=[],this.getHint=function(cm,c){return hint(self,cm,c)},this.getHint.async=!0},CodeMirror.TernServer.prototype={addDoc:function(name,doc){var data={doc:doc,name:name,changed:null};return this.server.addFile(name,docValue(this,data)),CodeMirror.on(doc,"change",this.trackChange),this.docs[name]=data},delDoc:function(id){var found=resolveDoc(this,id);found&&(CodeMirror.off(found.doc,"change",this.trackChange),delete this.docs[found.name],this.server.delFile(found.name))},hideDoc:function(id){closeArgHints(this);var found=resolveDoc(this,id);found&&found.changed&&sendDoc(this,found)},complete:function(cm){cm.showHint({hint:this.getHint})},showType:function(cm,pos,c){showContextInfo(this,cm,pos,"type",c)},showDocs:function(cm,pos,c){showContextInfo(this,cm,pos,"documentation",c)},updateArgHints:function(cm){updateArgHints(this,cm)},jumpToDef:function(cm){jumpToDef(this,cm)},jumpBack:function(cm){jumpBack(this,cm)},rename:function(cm){rename(this,cm)},selectName:function(cm){selectName(this,cm)},request:function(cm,query,c,pos){var self=this,doc=findDoc(this,cm.getDoc()),request=buildRequest(this,doc,query,pos),extraOptions=request.query&&this.options.queryOptions&&this.options.queryOptions[request.query.type];if(extraOptions)for(var prop in extraOptions)request.query[prop]=extraOptions[prop];this.server.request(request,function(error,data){!error&&self.options.responseFilter&&(data=self.options.responseFilter(doc,query,request,error,data)),c(error,data)})},destroy:function(){closeArgHints(this),this.worker&&(this.worker.terminate(),this.worker=null)}};var Pos=CodeMirror.Pos,cls="CodeMirror-Tern-",bigDoc=250,nextChangeOrig=0,cmpPos=CodeMirror.cmpPos})}});